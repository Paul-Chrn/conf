<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: transparent; }
    
    #container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    #canvas-wrapper {
        position: relative;
        flex-grow: 1;
        /* ATTENTION : Le code cherche ce nom exact ci-dessous */
        background-image: url('index.jpg'); 
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        overflow: hidden;
    }

    canvas {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        cursor: crosshair;
        touch-action: none;
    }

    #toolbar {
        height: 50px;
        background: #f4f4f4;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        border-top: 1px solid #ccc;
    }

    button {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        font-family: Arial, sans-serif;
    }
</style>
</head>
<body>

<div id="container">
    <div id="canvas-wrapper">
        <canvas id="drawing-board"></canvas>
    </div>

    <div id="toolbar">
        <button onclick="setPen('#FF0000')" style="background:#FF0000; color:white;">Rouge</button>
        <button onclick="setPen('#000000')" style="background:#333; color:white;">Noir</button>
        <button onclick="erase()" style="background:#999; color:white;">Effacer</button>
        <button onclick="sendToStoryline()" style="background:#2ecc71; color:white;">VALIDER</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('drawing-board');
    const ctx = canvas.getContext('2d');
    const wrapper = document.getElementById('canvas-wrapper');
    
    let isDrawing = false;
    let currentWidth = 3;
    let currentColor = '#FF0000';

    function resizeCanvas() {
        canvas.width = wrapper.clientWidth;
        canvas.height = wrapper.clientHeight;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentWidth;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    setTimeout(resizeCanvas, 500);

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function start(e) {
        if(e.cancelable) e.preventDefault();
        isDrawing = true;
        const pos = getPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }

    function move(e) {
        if (!isDrawing) return;
        if(e.cancelable) e.preventDefault();
        const pos = getPos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
    }

    function end() {
        isDrawing = false;
        ctx.beginPath();
    }

    canvas.addEventListener('mousedown', start);
    canvas.addEventListener('mousemove', move);
    canvas.addEventListener('mouseup', end);
    canvas.addEventListener('touchstart', start, {passive: false});
    canvas.addEventListener('touchmove', move, {passive: false});
    canvas.addEventListener('touchend', end);

    window.setPen = function(color) {
        currentColor = color;
        ctx.strokeStyle = color;
    }

    window.erase = function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    window.sendToStoryline = function() {
        var player = window.parent.GetPlayer(); 
        if(player) {
            try {
                player.SetVar("DessinFait", true);
                alert("Dessin valid√© !");
            } catch(e) { console.log("Erreur"); }
        } else {
            alert("Mode test hors Storyline : Validation OK");
        }
    }
</script>

</body>

</html>
